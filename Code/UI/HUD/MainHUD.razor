@namespace Facepunch.UI
@inherits PanelComponent

@implements Sandbox.Events.IGameEventHandler<KillEvent>

@if (!IsHudEnabled)
    return;

@if (GameUtils.Viewer is null)
    return;

<root>
    <ScreenProtectionOverlay />
    <DamageOverlay />

    <canvas>
        <Crosshair />

        <div class="hud with-deadzone top-left flex column">
            <Minimap />
            <MapCallouts />
            <Balance />
        </div>

        <Toast />
        <EquipmentOverlay />
        <PlayerInfo />
        <Spectating />

        <RoundStateDisplay />
        <DefuseKitDisplay />
        <DamageIndicator />
        <KillFeed @ref="KillFeed" />

        <div class="right">
            <div class="flex-grow" />
            <Voices />
            <WeaponInfoComponent />
        </div>

        <Radio />
    </canvas>
    
    <!-- Full-screen overlays -->
    <BuyMenu />
    <MarkerSystem />
    <Scoreboard />
</root>

@code 
{
    public static bool IsHudEnabled { get; set; } = true;

    [DeveloperCommand( "Toggle HUD", "Visuals" )]
    private static void Command_ToggleHUD()
    {
        IsHudEnabled = !IsHudEnabled;
    }

    public KillFeed KillFeed { get; set; }

    protected override int BuildHash()
    {
        return HashCode.Combine( IsHudEnabled, GameUtils.Viewer is null );
    }

    public void OnGameEvent( KillEvent eventArgs )
    {
        KillFeed.OnPlayerKilled( eventArgs.DamageInfo );
    }
}